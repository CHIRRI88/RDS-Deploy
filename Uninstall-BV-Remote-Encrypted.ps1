#=============================================================================
# CHIRRI RDS Deployment - Encrypted Script
# This script requires a password to execute
#=============================================================================

$ErrorActionPreference = "Stop"

function ConvertFrom-EncryptedPayload {
    param(
        [Parameter(Mandatory)][string]$EncryptedBase64,
        [Parameter(Mandatory)][SecureString]$Password
    )
    
    $BSTR = [System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($Password)
    $passwordPlain = [System.Runtime.InteropServices.Marshal]::PtrToStringAuto($BSTR)
    [System.Runtime.InteropServices.Marshal]::ZeroFreeBSTR($BSTR)
    
    $combined = [Convert]::FromBase64String($EncryptedBase64)
    
    $salt = New-Object byte[] 32
    $iv = New-Object byte[] 16
    $encryptedBytes = New-Object byte[] ($combined.Length - 48)
    
    [Array]::Copy($combined, 0, $salt, 0, 32)
    [Array]::Copy($combined, 32, $iv, 0, 16)
    [Array]::Copy($combined, 48, $encryptedBytes, 0, $encryptedBytes.Length)
    
    $keyDerivation = New-Object System.Security.Cryptography.Rfc2898DeriveBytes(
        $passwordPlain, 
        $salt, 
        100000,
        [System.Security.Cryptography.HashAlgorithmName]::SHA256
    )
    $key = $keyDerivation.GetBytes(32)
    $keyDerivation.Dispose()
    
    $passwordPlain = $null
    [System.GC]::Collect()
    
    $aes = [System.Security.Cryptography.Aes]::Create()
    $aes.Key = $key
    $aes.IV = $iv
    $aes.Mode = [System.Security.Cryptography.CipherMode]::CBC
    $aes.Padding = [System.Security.Cryptography.PaddingMode]::PKCS7
    
    $decryptor = $aes.CreateDecryptor()
    $decryptedBytes = $decryptor.TransformFinalBlock($encryptedBytes, 0, $encryptedBytes.Length)
    
    $aes.Dispose()
    
    return [System.Text.Encoding]::UTF8.GetString($decryptedBytes)
}

# Encrypted payload
$encryptedPayload = "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"

# Prompt for password
Write-Host ""
Write-Host "========================================" -ForegroundColor Cyan
Write-Host " CHIRRI BV Remote Desktop Setup" -ForegroundColor Cyan
Write-Host "========================================" -ForegroundColor Cyan
Write-Host ""
$securePassword = Read-Host "Enter setup password" -AsSecureString

# Attempt decryption and execution
try {
    $decryptedScript = ConvertFrom-EncryptedPayload -EncryptedBase64 $encryptedPayload -Password $securePassword
    Invoke-Expression $decryptedScript
}
catch {
    Write-Host ""
    Write-Host "ERROR: Invalid password or corrupted data." -ForegroundColor Red
    Write-Host ""
    Write-Host "If you believe this is an error, contact IT support." -ForegroundColor Yellow
    Write-Host ""
    exit 1
}

