#=============================================================================
# CHIRRI RDS Deployment - Encrypted Script
# This script requires a password to execute
#=============================================================================

$ErrorActionPreference = "Stop"

function ConvertFrom-EncryptedPayload {
    param(
        [Parameter(Mandatory)][string]$EncryptedBase64,
        [Parameter(Mandatory)][SecureString]$Password
    )
    
    $BSTR = [System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($Password)
    $passwordPlain = [System.Runtime.InteropServices.Marshal]::PtrToStringAuto($BSTR)
    [System.Runtime.InteropServices.Marshal]::ZeroFreeBSTR($BSTR)
    
    $combined = [Convert]::FromBase64String($EncryptedBase64)
    
    $salt = New-Object byte[] 32
    $iv = New-Object byte[] 16
    $encryptedBytes = New-Object byte[] ($combined.Length - 48)
    
    [Array]::Copy($combined, 0, $salt, 0, 32)
    [Array]::Copy($combined, 32, $iv, 0, 16)
    [Array]::Copy($combined, 48, $encryptedBytes, 0, $encryptedBytes.Length)
    
    $keyDerivation = New-Object System.Security.Cryptography.Rfc2898DeriveBytes(
        $passwordPlain, 
        $salt, 
        100000,
        [System.Security.Cryptography.HashAlgorithmName]::SHA256
    )
    $key = $keyDerivation.GetBytes(32)
    $keyDerivation.Dispose()
    
    $passwordPlain = $null
    [System.GC]::Collect()
    
    $aes = [System.Security.Cryptography.Aes]::Create()
    $aes.Key = $key
    $aes.IV = $iv
    $aes.Mode = [System.Security.Cryptography.CipherMode]::CBC
    $aes.Padding = [System.Security.Cryptography.PaddingMode]::PKCS7
    
    $decryptor = $aes.CreateDecryptor()
    $decryptedBytes = $decryptor.TransformFinalBlock($encryptedBytes, 0, $encryptedBytes.Length)
    
    $aes.Dispose()
    
    return [System.Text.Encoding]::UTF8.GetString($decryptedBytes)
}

# Encrypted payload
$encryptedPayload = "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"

# Prompt for password
Write-Host ""
Write-Host "========================================" -ForegroundColor Cyan
Write-Host " CHIRRI BV Remote Desktop Setup" -ForegroundColor Cyan
Write-Host "========================================" -ForegroundColor Cyan
Write-Host ""
$securePassword = Read-Host "Enter setup password" -AsSecureString

# Attempt decryption and execution
try {
    $decryptedScript = ConvertFrom-EncryptedPayload -EncryptedBase64 $encryptedPayload -Password $securePassword
    Invoke-Expression $decryptedScript
}
catch {
    Write-Host ""
    Write-Host "ERROR: Invalid password or corrupted data." -ForegroundColor Red
    Write-Host ""
    Write-Host "If you believe this is an error, contact IT support." -ForegroundColor Yellow
    Write-Host ""
    exit 1
}
